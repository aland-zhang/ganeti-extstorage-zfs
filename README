Ganeti extstorage provider for local zfs volumes

http://docs.ganeti.org/ganeti/master/html/man-ganeti-extstorage-interface.html

INSTALLATION

On node which will host zfs storage pool

  cd /usr/share/ganeti/extstorage/
  git clone https://github.com/ffzg/ganeti-extstorage-zfs zfs
  cd zfs
  vi defaults.sh

Run install scripts:

# ls install/
1-enable-ext-template.sh  2-create-log-directory.sh  3-lvm-wrappers.sh

Cron helper can be install under /etc/cron.daily

# ls cron/
daily-block-snapshot  purge-log

Overview commands are available (try running them to see output):

# ls bin/
adopt  backup  ill  instance  list  node

backup and instance are wrappers for running gnt-* commands
with same name on master node

Create test instances:

# ls t/*.sh
t/drbd.sh  t/plain.sh  t/zfs.sh

Review that instaces have been created:

# ./bin/ill t-

Test ganeti commands after reading them:

# ls t/gnt-*
t/gnt-backup-export.sh  t/gnt-instance-modify.sh


DRBD disk replication

Ganeti's extstorage provider doesn't support drbd target. But, lvm emulation scripts are sufficiant enough
to create -t drbd instance or convert plain (created on zfs thanks to wrappers ;-) to drbd.


KNOWN BUGS for extstorage

- gnt-backup export doesn't work because extstorage snapshoot hook are not available
- gnt-instance move works from somewhere to zfs, but not from zfs to somewhere


KNOWN BUGS for using -t plain on top of zfs

- cron/daily-block-snapshot snapshots are not correctly renamed
- bin/adopt will create new zvol using send/receive to break dependency on origin
  (otherwise, deleting of origin file system will also delete new adopted instance)
